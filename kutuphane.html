<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerçekçi Dijital Kütüphane Sistemi</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React ve Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Yatay kaydırma çubuğu için stil */
        .shelf-scroll::-webkit-scrollbar {
            height: 8px;
        }
        .shelf-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .shelf-scroll::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        .shelf-scroll::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- İkonlar ---
        const BookIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>);
        const UserIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>);
        const SearchIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>);
        const PlusCircleIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" /></svg>);
        const TrashIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></svg>);
        const LogOutIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" y1="12" x2="9" y2="12" /></svg>);
        const ArrowLeftIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>);
        const InfoIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>);
        const CheckCircleIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>);
        const AlertTriangleIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>);
        const UserCheckIcon = ({ className }) => (<svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>);

        // --- Başlangıç Verileri ---
        const initialBooksData = [
            { id: 1, title: 'Sefiller', author: 'Victor Hugo', year: 1862, category: 'Roman', cover: 'https://placehold.co/300x450/7c3aed/ffffff?text=Sefiller', description: 'Fransız yazar Victor Hugo tarafından yazılan ve 1862 yılında yayımlanan tarihi bir romandır.', copies: { total: 3, available: 2 }, popularity: 8, newArrival: true },
            { id: 2, title: 'Suç ve Ceza', author: 'Fyodor Dostoyevski', year: 1866, category: 'Roman', cover: 'https://placehold.co/300x450/1d4ed8/ffffff?text=Suç+ve+Ceza', description: 'Yoksul bir öğrenci olan Raskolnikov\'un, yaşlı bir tefeciyi öldürmesini ve ardından yaşadığı ahlaki ve psikolojik çatışmaları anlatan bir romandır.', copies: { total: 2, available: 2 }, popularity: 9, newArrival: false },
            { id: 3, title: '1984', author: 'George Orwell', year: 1949, category: 'Bilim Kurgu', cover: 'https://placehold.co/300x450/be123c/ffffff?text=1984', description: 'Distopik bir roman olan 1984, totaliter bir rejim altında yaşayan insanların hayatını ve düşünce özgürlüğünün yok edilişini konu alır.', copies: { total: 4, available: 0 }, popularity: 10, newArrival: false },
            { id: 4, title: 'Simyacı', author: 'Paulo Coelho', year: 1988, category: 'Felsefe', cover: 'https://placehold.co/300x450/15803d/ffffff?text=Simyacı', description: 'Endülüslü bir çoban olan Santiago\'nun, Mısır Piramitleri\'nde bir hazine bulma hayaliyle çıktığı yolculuğu anlatan felsefi bir romandır.', copies: { total: 5, available: 5 }, popularity: 7, newArrival: false },
            { id: 5, title: 'Dune', author: 'Frank Herbert', year: 1965, category: 'Bilim Kurgu', cover: 'https://placehold.co/300x450/ea580c/ffffff?text=Dune', description: 'Uzak bir gelecekte geçen, gezegenler arası bir imparatorlukta geçen epik bir bilim kurgu romanıdır.', copies: { total: 3, available: 3 }, popularity: 8, newArrival: true },
            { id: 6, title: 'Nutuk', author: 'Mustafa Kemal Atatürk', year: 1927, category: 'Tarih', cover: 'https://placehold.co/300x450/b91c1c/ffffff?text=Nutuk', description: 'Mustafa Kemal Atatürk\'ün 1919-1927 yılları arasındaki dönemi anlattığı, Türk tarihinin temel eserlerinden biridir.', copies: { total: 10, available: 8 }, popularity: 6, newArrival: false },
            { id: 7, title: 'Kürk Mantolu Madonna', author: 'Sabahattin Ali', year: 1943, category: 'Roman', cover: 'https://placehold.co/300x450/4a044e/ffffff?text=Kürk+Mantolu+Madonna', description: 'Raif Efendi\'nin Berlin\'deki sanat galerisinde tanıştığı Maria Puder ile yaşadığı aşkı ve içsel yolculuğunu konu alır.', copies: { total: 6, available: 5 }, popularity: 9, newArrival: false },
        ];

        const initialUsersData = [
            { id: 1, name: 'Ayşe Yılmaz', role: 'user', fines: 0, borrowedBooks: [{bookId: 3, dueDate: '2025-08-15'}], history: [], reservations: [] },
            { id: 2, name: 'Ali Veli', role: 'user', fines: 0, borrowedBooks: [], history: [], reservations: [] },
            { id: 3, name: 'Zeynep Kaya', role: 'librarian' },
            { id: 4, name: 'Mehmet Öztürk', role: 'admin' },
        ];

        // --- LocalStorage için Custom Hook ---
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) { console.log(error); return initialValue; }
            });
            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) { console.log(error); }
            };
            return [storedValue, setValue];
        };

        // --- Ana Uygulama Bileşeni ---
        function App() {
            const [books, setBooks] = useLocalStorage('library_books_v2', initialBooksData);
            const [users, setUsers] = useLocalStorage('library_users_v2', initialUsersData);
            
            const [currentPage, setCurrentPage] = useState('login');
            const [currentUser, setCurrentUser] = useState(null);
            const [selectedBook, setSelectedBook] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [showModal, setShowModal] = useState(null);
            const [notification, setNotification] = useState({ message: '', type: '', show: false });
            const [confirmAction, setConfirmAction] = useState(null);

            const showNotification = (message, type = 'info') => {
                setNotification({ message, type, show: true });
                setTimeout(() => setNotification({ message: '', type: '', show: false }), 3000);
            };
            
            const withConfirmation = (action, message) => {
                setConfirmAction(() => action);
                setShowModal({ type: 'confirm', message });
            };

            const handleConfirm = () => {
                if (confirmAction) confirmAction();
                setShowModal(null);
                setConfirmAction(null);
            };

            const handleLogin = (userId) => {
                setCurrentUser(users.find(u => u.id === userId));
                setCurrentPage('dashboard');
                showNotification(`Hoş geldin, ${users.find(u => u.id === userId).name}!`, 'success');
            };

            const handleGuestLogin = () => {
                setCurrentUser({ name: 'Misafir', role: 'guest' });
                setCurrentPage('dashboard');
                showNotification('Misafir olarak giriş yaptınız.');
            };

            const handleLogout = () => {
                showNotification(`${currentUser.name} başarıyla çıkış yaptı.`);
                setCurrentUser(null);
                setCurrentPage('login');
            };
            
            const handleSelectBook = (book) => {
                setSelectedBook(book);
                setCurrentPage('bookDetail');
            };

            const handleAddBook = (newBook) => {
                setBooks(prev => [...prev, { ...newBook, id: Date.now() }]);
                setShowModal(null);
                showNotification(`${newBook.title} başarıyla eklendi.`, 'success');
            };

            const handleDeleteBook = (bookId) => {
                setBooks(prev => prev.filter(b => b.id !== bookId));
                showNotification('Kitap başarıyla silindi.', 'success');
            };

            const handleBorrowBook = (bookId) => {
                const today = new Date();
                const dueDate = new Date(today.setDate(today.getDate() + 14)).toISOString().split('T')[0];
                
                setBooks(prevBooks => prevBooks.map(b => b.id === bookId ? { ...b, copies: { ...b.copies, available: b.copies.available - 1 } } : b));
                
                setUsers(prevUsers => prevUsers.map(u => u.id === currentUser.id ? { ...u, borrowedBooks: [...u.borrowedBooks, { bookId, dueDate }] } : u));
                
                handleSelectBook(books.find(b => b.id === bookId));
                showNotification('Kitabı başarıyla ödünç aldınız. İyi okumalar!', 'success');
            };

            const handleReturnBook = (bookId) => {
                setBooks(prevBooks => prevBooks.map(b => b.id === bookId ? { ...b, copies: { ...b.copies, available: b.copies.available + 1 } } : b));
                
                setUsers(prevUsers => prevUsers.map(u => {
                    if (u.id === currentUser.id) {
                        const returnedBook = u.borrowedBooks.find(b => b.bookId === bookId);
                        return { 
                            ...u, 
                            borrowedBooks: u.borrowedBooks.filter(b => b.bookId !== bookId),
                            history: [...u.history, returnedBook]
                        };
                    }
                    return u;
                }));
                
                handleSelectBook(books.find(b => b.id === bookId));
                showNotification('Kitap başarıyla iade edildi.', 'success');
            };

            const handleReserveBook = (bookId) => {
                setUsers(prevUsers => prevUsers.map(u => u.id === currentUser.id ? { ...u, reservations: [...u.reservations, bookId] } : u));
                handleSelectBook(books.find(b => b.id === bookId));
                showNotification('Kitap adınıza rezerve edildi.', 'success');
            };
            
            const handleCancelReservation = (bookId) => {
                setUsers(prevUsers => prevUsers.map(u => u.id === currentUser.id ? { ...u, reservations: u.reservations.filter(id => id !== bookId) } : u));
                showNotification('Rezervasyon iptal edildi.', 'success');
            };

            const filteredBooks = useMemo(() => 
                books.filter(book => 
                    book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    book.author.toLowerCase().includes(searchTerm.toLowerCase())
                ), [books, searchTerm]);

            const renderPage = () => {
                if (selectedBook && currentPage === 'bookDetail') {
                    return <BookDetailPage book={selectedBook} currentUser={currentUser} onBack={() => { setSelectedBook(null); setCurrentPage('dashboard'); }} onBorrow={handleBorrowBook} onReturn={handleReturnBook} onReserve={handleReserveBook} showNotification={showNotification} users={users} />;
                }

                switch (currentPage) {
                    case 'login': return <LoginPage users={users} onLogin={handleLogin} onGuestLogin={handleGuestLogin} />;
                    case 'dashboard': return <DashboardPage currentUser={currentUser} books={books} searchTerm={searchTerm} setSearchTerm={setSearchTerm} onSelectBook={handleSelectBook} />;
                    case 'admin': return <AdminPage users={users} />;
                    case 'librarian': return <LibrarianPage books={books} users={users} onAddClick={() => setShowModal({ type: 'add' })} onDelete={(id) => withConfirmation(() => handleDeleteBook(id), 'Bu kitabı kalıcı olarak silmek istediğinizden emin misiniz?')} />;
                    case 'account': return <AccountPage currentUser={currentUser} users={users} books={books} onReturn={handleReturnBook} onCancelReservation={handleCancelReservation} />;
                    default: return <LoginPage users={users} onLogin={handleLogin} onGuestLogin={handleGuestLogin} />;
                }
            };

            return (
                <div className="bg-slate-100 min-h-screen font-sans text-slate-800">
                    <Notification notification={notification} />
                    {showModal?.type === 'add' && <AddBookModal onClose={() => setShowModal(null)} onSave={handleAddBook} />}
                    {showModal?.type === 'confirm' && <ConfirmModal message={showModal.message} onConfirm={handleConfirm} onCancel={() => setShowModal(null)} />}
                    
                    {currentUser && currentPage !== 'login' && <Header currentUser={currentUser} onLogout={handleLogout} setCurrentPage={setCurrentPage} />}
                    <main className="p-4 sm:p-6 lg:p-8">
                        {renderPage()}
                    </main>
                </div>
            );
        }

        // --- Sayfa Bileşenleri ---
        const LoginPage = ({ users, onLogin, onGuestLogin }) => (
            <div className="flex items-center justify-center min-h-screen bg-slate-200">
                <div className="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-2xl">
                    <div className="text-center">
                        <BookIcon className="w-16 h-16 mx-auto text-indigo-600" />
                        <h1 className="text-3xl font-bold mt-4">Dijital Kütüphane</h1>
                        <p className="text-slate-500 mt-2">Giriş yapın veya misafir olarak keşfedin.</p>
                    </div>
                    <div className="space-y-3">
                        {users.filter(u => u.role !== 'guest').map(user => (
                            <button key={user.id} onClick={() => onLogin(user.id)} className="w-full flex items-center p-4 text-left bg-slate-50 hover:bg-indigo-100 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <UserIcon className="w-6 h-6 mr-4 text-indigo-500" />
                                <div><p className="font-semibold">{user.name}</p><p className="text-sm text-slate-500 capitalize">{user.role}</p></div>
                            </button>
                        ))}
                    </div>
                    <div className="relative flex py-2 items-center"><div className="flex-grow border-t border-gray-300"></div><span className="flex-shrink mx-4 text-gray-400">veya</span><div className="flex-grow border-t border-gray-300"></div></div>
                    <button onClick={onGuestLogin} className="w-full p-4 text-center bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-all duration-200">Misafir Olarak Devam Et</button>
                </div>
            </div>
        );

        const Header = ({ currentUser, onLogout, setCurrentPage }) => (
            <header className="bg-white shadow-md sticky top-0 z-40">
                <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between h-16">
                        <div className="flex items-center space-x-4 cursor-pointer" onClick={() => setCurrentPage('dashboard')}><BookIcon className="w-8 h-8 text-indigo-600" /><span className="text-xl font-bold">Kütüphane Sistemi</span></div>
                        <nav className="hidden md:flex items-center space-x-2">
                            <button onClick={() => setCurrentPage('dashboard')} className="px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 hover:text-indigo-600">Ana Sayfa</button>
                            {currentUser.role !== 'guest' && <button onClick={() => setCurrentPage('account')} className="px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 hover:text-indigo-600">Hesabım</button>}
                            {['admin', 'librarian'].includes(currentUser.role) && <button onClick={() => setCurrentPage('librarian')} className="px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 hover:text-indigo-600">Kütüphaneci Paneli</button>}
                            {currentUser.role === 'admin' && <button onClick={() => setCurrentPage('admin')} className="px-3 py-2 rounded-md text-sm font-medium text-slate-600 hover:bg-slate-100 hover:text-indigo-600">Admin Paneli</button>}
                        </nav>
                        <div className="flex items-center space-x-4">
                            <div className="text-right"><p className="font-semibold">{currentUser.name}</p>{currentUser.role !== 'guest' && <p className="text-sm text-slate-500 capitalize">{currentUser.role}</p>}</div>
                            {currentUser.role !== 'guest' && (<button onClick={onLogout} className="p-2 rounded-full hover:bg-slate-100 transition"><LogOutIcon className="w-6 h-6 text-slate-500" /></button>)}
                        </div>
                    </div>
                </div>
            </header>
        );

        const DashboardPage = ({ currentUser, books, searchTerm, setSearchTerm, onSelectBook }) => {
            const newArrivals = books.filter(b => b.newArrival).slice(0, 10);
            const popularBooks = [...books].sort((a,b) => b.popularity - a.popularity).slice(0, 10);
            const categories = [...new Set(books.map(b => b.category))];

            return (
                <div>
                    <div className="bg-white p-6 rounded-xl shadow-md mb-8">
                        <h1 className="text-3xl font-bold mb-2">Hoş Geldin, {currentUser.name}!</h1>
                        <p className="text-slate-600">Kütüphanemizin dijital raflarında bir gezintiye çık.</p>
                        <div className="mt-6 relative">
                            <input type="text" placeholder="Aradığınız bir kitap veya yazar var mı?" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full p-4 pl-12 text-lg border-2 border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" />
                            <SearchIcon className="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-slate-400" />
                        </div>
                    </div>
                    
                    <BookShelf title="Popüler Kitaplar" books={popularBooks} onSelectBook={onSelectBook} />
                    <BookShelf title="Yeni Gelenler" books={newArrivals} onSelectBook={onSelectBook} />
                    {categories.map(category => (
                         <BookShelf key={category} title={category} books={books.filter(b => b.category === category)} onSelectBook={onSelectBook} />
                    ))}
                </div>
            );
        };
        
        const BookShelf = ({ title, books, onSelectBook }) => (
            <div className="mb-12">
                <h2 className="text-2xl font-bold mb-4 border-b-2 border-indigo-200 pb-2">{title}</h2>
                <div className="flex overflow-x-auto space-x-6 pb-4 shelf-scroll">
                    {books.map(book => (
                        <div key={book.id} className="flex-shrink-0 w-48">
                            <BookCard book={book} onSelectBook={onSelectBook} />
                        </div>
                    ))}
                </div>
            </div>
        );

        const BookCard = ({ book, onSelectBook }) => (
            <div onClick={() => onSelectBook(book)} className="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col h-full transition-transform hover:-translate-y-2 duration-300 cursor-pointer group">
                <img src={book.cover} alt={book.title} className="w-full h-64 object-cover" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/300x450/cccccc/ffffff?text=Görsel+Yok'; }}/>
                <div className="p-3 flex flex-col flex-grow">
                    <h3 className="font-bold text-md truncate group-hover:text-indigo-600">{book.title}</h3>
                    <p className="text-slate-500 text-sm mb-2">{book.author}</p>
                    <div className="mt-auto text-xs font-semibold text-slate-600">
                        {book.copies.available > 0 ? `${book.copies.available} Kopya Müsait` : 'Tüm Kopyalar Ödünç Alındı'}
                    </div>
                </div>
            </div>
        );
        
        const BookDetailPage = ({ book, currentUser, onBack, onBorrow, onReturn, onReserve, showNotification, users }) => {
            const isGuest = currentUser.role === 'guest';
            const canBorrow = !isGuest && book.copies.available > 0;
            const canReturn = !isGuest && users.find(u => u.id === currentUser.id)?.borrowedBooks.some(b => b.bookId === book.id);
            const canReserve = !isGuest && book.copies.available === 0 && !users.find(u => u.id === currentUser.id)?.reservations.includes(book.id);

            const handleAction = (action, bookId) => {
                if(isGuest) {
                    showNotification('Bu işlemi yapmak için giriş yapmalısınız.', 'warning');
                    return;
                }
                action(bookId);
            }

            return (
                <div className="bg-white p-6 sm:p-8 rounded-xl shadow-xl max-w-5xl mx-auto">
                    <button onClick={onBack} className="flex items-center text-slate-600 hover:text-indigo-600 font-semibold mb-6"><ArrowLeftIcon className="w-5 h-5 mr-2" /> Raflara Geri Dön</button>
                    <div className="flex flex-col md:flex-row gap-8">
                        <img src={book.cover} alt={book.title} className="w-full md:w-1/3 h-auto object-cover rounded-lg shadow-lg" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/300x450/cccccc/ffffff?text=Görsel+Yok'; }}/>
                        <div className="flex-1">
                            <p className="text-sm font-semibold text-indigo-600 mb-1">{book.category}</p>
                            <h1 className="text-4xl font-bold mb-2">{book.title}</h1>
                            <h2 className="text-2xl text-slate-500 mb-4">{book.author} ({book.year})</h2>
                            <p className="text-slate-700 leading-relaxed mb-6">{book.description}</p>
                            
                            <div className="bg-slate-50 p-4 rounded-lg mb-6">
                                <h3 className="font-bold text-lg mb-2">Durum</h3>
                                <p>Toplam Kopya: <span className="font-semibold">{book.copies.total}</span></p>
                                <p>Müsait Kopya: <span className="font-semibold text-green-600">{book.copies.available}</span></p>
                            </div>

                            <div className="space-y-4">
                                {canBorrow && <button onClick={() => handleAction(onBorrow, book.id)} className="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition">Ödünç Al</button>}
                                {canReturn && <button onClick={() => handleAction(onReturn, book.id)} className="w-full bg-sky-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-sky-600 transition">İade Et</button>}
                                {canReserve && <button onClick={() => handleAction(onReserve, book.id)} className="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 transition">Rezerve Et</button>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const AccountPage = ({ currentUser, users, books, onReturn, onCancelReservation }) => {
            const userData = users.find(u => u.id === currentUser.id);
            if (!userData) return <div>Kullanıcı bulunamadı.</div>;

            const borrowedBookDetails = userData.borrowedBooks.map(b => {
                const bookInfo = books.find(book => book.id === b.bookId);
                return { ...bookInfo, dueDate: b.dueDate };
            });

            const reservationDetails = userData.reservations.map(id => books.find(book => book.id === id));
            
            return (
                <div className="max-w-5xl mx-auto">
                    <h1 className="text-4xl font-bold mb-8">Hesabım</h1>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div className="md:col-span-2 space-y-8">
                            {/* Ödünç Alınanlar */}
                            <div>
                                <h2 className="text-2xl font-semibold mb-4">Ödünç Aldığım Kitaplar ({borrowedBookDetails.length})</h2>
                                <div className="bg-white p-4 rounded-lg shadow-md space-y-4">
                                    {borrowedBookDetails.length > 0 ? borrowedBookDetails.map(book => (
                                        <div key={book.id} className="flex items-center justify-between p-2 border-b">
                                            <div>
                                                <p className="font-bold">{book.title}</p>
                                                <p className="text-sm text-slate-500">İade Tarihi: {book.dueDate}</p>
                                            </div>
                                            <button onClick={() => onReturn(book.id)} className="px-3 py-1 bg-sky-500 text-white text-sm rounded-md hover:bg-sky-600">İade Et</button>
                                        </div>
                                    )) : <p>Şu an ödünç aldığınız kitap bulunmuyor.</p>}
                                </div>
                            </div>
                            {/* Rezervasyonlar */}
                            <div>
                                <h2 className="text-2xl font-semibold mb-4">Rezervasyonlarım ({reservationDetails.length})</h2>
                                <div className="bg-white p-4 rounded-lg shadow-md space-y-4">
                                    {reservationDetails.length > 0 ? reservationDetails.map(book => (
                                        <div key={book.id} className="flex items-center justify-between p-2 border-b">
                                            <div>
                                                <p className="font-bold">{book.title}</p>
                                                <p className="text-sm text-slate-500">Müsait olduğunda haber verilecek.</p>
                                            </div>
                                            <button onClick={() => onCancelReservation(book.id)} className="px-3 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600">İptal Et</button>
                                        </div>
                                    )) : <p>Aktif rezervasyonunuz bulunmuyor.</p>}
                                </div>
                            </div>
                        </div>
                        {/* Profil Kartı */}
                        <div className="bg-white p-6 rounded-lg shadow-md self-start">
                            <UserCheckIcon className="w-16 h-16 mx-auto text-indigo-500 mb-4"/>
                            <h3 className="text-2xl font-bold text-center">{userData.name}</h3>
                            <p className="text-center text-slate-500 capitalize mb-6">{userData.role}</p>
                            <div className="text-center bg-red-100 text-red-800 p-4 rounded-lg">
                                <p className="text-sm">Toplam Ceza Borcu</p>
                                <p className="text-3xl font-bold">{userData.fines} TL</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const AdminPage = ({ users }) => (
            <div className="bg-white p-6 rounded-xl shadow-md">
                <h1 className="text-3xl font-bold mb-6">Admin Paneli - Kullanıcı Yönetimi</h1>
                <div className="overflow-x-auto">
                    <table className="w-full text-left">
                        <thead className="bg-slate-50"><tr><th className="p-4 font-semibold">ID</th><th className="p-4 font-semibold">İsim</th><th className="p-4 font-semibold">Rol</th><th className="p-4 font-semibold">Ceza Tutarı</th></tr></thead>
                        <tbody>
                            {users.filter(u => u.role !== 'guest').map(user => (<tr key={user.id} className="border-b"><td className="p-4">{user.id}</td><td className="p-4">{user.name}</td><td className="p-4 capitalize">{user.role}</td><td className="p-4">{user.fines > 0 ? `${user.fines} TL` : 'Yok'}</td></tr>))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const LibrarianPage = ({ books, users, onAddClick, onDelete }) => (
            <div className="bg-white p-6 rounded-xl shadow-md">
                <div className="flex justify-between items-center mb-6"><h1 className="text-3xl font-bold">Kütüphaneci Paneli</h1><button onClick={onAddClick} className="flex items-center bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition"><PlusCircleIcon className="w-5 h-5 mr-2"/>Yeni Kitap Ekle</button></div>
                <h2 className="text-2xl font-semibold mb-4">Tüm Kitaplar</h2>
                <div className="overflow-x-auto">
                    <table className="w-full text-left">
                        <thead className="bg-slate-50"><tr><th className="p-4 font-semibold">Kitap Adı</th><th className="p-4 font-semibold">Yazar</th><th className="p-4 font-semibold">Müsait / Toplam</th><th className="p-4 font-semibold">İşlemler</th></tr></thead>
                        <tbody>
                            {books.map(book => (<tr key={book.id} className="border-b"><td className="p-4">{book.title}</td><td className="p-4">{book.author}</td><td className="p-4">{book.copies.available} / {book.copies.total}</td><td className="p-4"><button onClick={() => onDelete(book.id)} className="text-red-500 hover:text-red-700"><TrashIcon className="w-5 h-5"/></button></td></tr>))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // --- Modal ve Bildirim Bileşenleri ---
        const AddBookModal = ({ onClose, onSave }) => {
            const [title, setTitle] = useState('');
            const [author, setAuthor] = useState('');
            const [year, setYear] = useState('');
            const [cover, setCover] = useState('');
            const [description, setDescription] = useState('');
            const [category, setCategory] = useState('Roman');
            const [totalCopies, setTotalCopies] = useState(1);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({ title, author, year: parseInt(year), cover, description, category, copies: { total: parseInt(totalCopies), available: parseInt(totalCopies) }, popularity: 0, newArrival: true });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div className="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg"><h2 className="text-2xl font-bold mb-6">Yeni Kitap Ekle</h2><form onSubmit={handleSubmit} className="space-y-4"><input type="text" placeholder="Kitap Adı" value={title} onChange={e => setTitle(e.target.value)} className="w-full p-2 border border-slate-300 rounded-md" required /><input type="text" placeholder="Yazar" value={author} onChange={e => setAuthor(e.target.value)} className="w-full p-2 border border-slate-300 rounded-md" required /><div className="flex space-x-4"><input type="number" placeholder="Yayın Yılı" value={year} onChange={e => setYear(e.target.value)} className="w-1/2 p-2 border border-slate-300 rounded-md" required /><input type="text" placeholder="Kategori" value={category} onChange={e => setCategory(e.target.value)} className="w-1/2 p-2 border border-slate-300 rounded-md" required /></div><input type="text" placeholder="Kapak Görseli URL" value={cover} onChange={e => setCover(e.target.value)} className="w-full p-2 border border-slate-300 rounded-md" /><textarea placeholder="Açıklama" value={description} onChange={e => setDescription(e.target.value)} className="w-full p-2 border border-slate-300 rounded-md" rows="3" required></textarea><div><label className="block text-sm font-medium text-slate-700">Kopya Sayısı</label><input type="number" value={totalCopies} onChange={e => setTotalCopies(e.target.value)} className="w-full p-2 border border-slate-300 rounded-md" min="1" required /></div><div className="flex justify-end space-x-4 pt-4"><button type="button" onClick={onClose} className="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300">İptal</button><button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Kitabı Ekle</button></div></form></div></div>
            );
        };
        
        const ConfirmModal = ({ message, onConfirm, onCancel }) => (<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div className="bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm text-center"><AlertTriangleIcon className="w-16 h-16 mx-auto text-yellow-500 mb-4" /><p className="text-lg text-slate-700 mb-6">{message}</p><div className="flex justify-center space-x-4"><button onClick={onCancel} className="px-6 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300">İptal</button><button onClick={onConfirm} className="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Onayla</button></div></div></div>);

        const Notification = ({ notification }) => {
            if (!notification.show) return null;
            const style = {
                info: { bg: 'bg-blue-500', icon: <InfoIcon className="w-6 h-6 text-white"/> },
                success: { bg: 'bg-green-500', icon: <CheckCircleIcon className="w-6 h-6 text-white"/> },
                warning: { bg: 'bg-yellow-500', icon: <AlertTriangleIcon className="w-6 h-6 text-white"/> },
            }[notification.type];
            return (<div className={`fixed bottom-5 right-5 ${style.bg} text-white p-4 rounded-lg shadow-lg flex items-center space-x-4 z-50 transition-transform duration-300 transform ${notification.show ? 'translate-x-0' : 'translate-x-full'}`}>{style.icon}<span>{notification.message}</span></div>);
        };

        // React uygulamasını render et
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
